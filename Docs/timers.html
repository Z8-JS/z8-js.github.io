<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Timers (Event Loop) | Z8 Runtime</title>
    <link rel="stylesheet" href="../style.css">
</head>
<body>
    <div class="bg-gradient"></div>
    
    <nav>
        <a href="../index.html" class="logo">Z8 RUNTIME</a>
        <div class="nav-links">
            <a href="../index.html">Home</a>
            <a href="index.html">Docs</a>
            <a href="https://github.com/Z8-JS/Z8-app" target="_blank">GitHub</a>
        </div>
    </nav>

    <div class="container docs-layout">
        <aside class="sidebar">
            <h3>Overview</h3>
            <ul>
                <li><a href="index.html">Introduction</a></li>
            </ul>
            <br>
            <h3>Global API</h3>
            <ul>
                <li><a href="console.html">console</a></li>
                <li><a href="timers.html" class="active">timers</a></li>
            </ul>
            <br>
            <h3>Native Modules</h3>
            <ul>
                <li><a href="#">fs (soon)</a></li>
                <li><a href="#">signals (soon)</a></li>
            </ul>
        </aside>

        <main class="content">
            <h1>Timers & Event Loop</h1>
            <p>Z8 features a high-performance, precision-engineered Event Loop. While <code>setTimeout</code> is a standard API, Z8's implementation is designed for maximum throughput and minimum latency, often outperforming other runtimes by multiple orders of magnitude.</p>
            
            <div class="method-card" id="setTimeout">
                <h3>setTimeout(callback, delay[, ...args])</h3>
                <p>Schedules execution of a <code>callback</code> after <code>delay</code> milliseconds.</p>
                <ul>
                    <li><code>callback</code>: The function to execute.</li>
                    <li><code>delay</code>: Time to wait in milliseconds.</li>
                    <li><code>...args</code>: Optional arguments passed to the callback.</li>
                </ul>
                <p>Returns a unique <code>timeoutId</code> (integer).</p>
                <div class="highlight-box">
                    <strong>Z8 Speciality:</strong> Unlike Node.js or browsers, Z8 does <strong>NOT</strong> clamp the minimum delay. A <code>0ms</code> delay is treated as "immediate next tick" without the 1ms overhead found in other runtimes.
                </div>
                <pre><code>setTimeout((msg) => {
    console.log(msg);
}, 0, "Z8 is blazing fast!");</code></pre>
            </div>

            <div class="method-card" id="clearTimeout">
                <h3>clearTimeout(timeoutId)</h3>
                <p>Cancels a timeout so its callback is never executed.</p>
                <pre><code>const id = setTimeout(() => { ... }, 5000);
clearTimeout(id);</code></pre>
            </div>

            <div class="method-card" id="setInterval">
                <h3>setInterval(callback, delay[, ...args])</h3>
                <p>Repeatedly calls a <code>callback</code> with a fixed time delay between each call.</p>
                <ul>
                    <li><code>callback</code>: The function to execute.</li>
                    <li><code>delay</code>: Time to wait between calls in milliseconds.</li>
                    <li><code>...args</code>: Optional arguments passed to the callback.</li>
                </ul>
                <p>Returns an <code>intervalId</code> (integer).</p>
                <div class="highlight-box">
                    <strong>Note:</strong> Z8 enforces a minimum interval of <code>1ms</code> for <code>setInterval</code> to prevent accidental infinite synchronous loops that could lock the process.
                </div>
                <pre><code>setInterval(() => {
    console.log("Heartbeat...");
}, 1000);</code></pre>
            </div>

            <div class="method-card" id="clearInterval">
                <h3>clearInterval(intervalId)</h3>
                <p>Cancels a timed, repeating action which was previously established by a call to <code>setInterval()</code>.</p>
                <pre><code>const id = setInterval(task, 100);
clearInterval(id);</code></pre>
            </div>

            <h2>ðŸ’Ž The Z8 Advantage: Technical Architecture</h2>
            
            <h3>1. Zero Clamping Strategy</h3>
            <p>Most runtimes (Node.js, Bun, Browsers) impose a minimum delay of 1ms or 4ms internally for <code>setTimeout(..., 0)</code>. Z8 respects your code: if you say 0ms, it executes as soon as the current script finishes, allowing for ultra-fast recursive task scheduling.</p>

            <h3>2. Sleep-to-Efficiency Loop</h3>
            <p>Z8 uses a native C++ event loop that calculates the exact time until the next timer expires.
                <ul>
                    <li>If timers are due, it executes them with microsecond precision.</li>
                    <li>If the next timer is in the future, the process <strong>sleeps</strong> at the OS level, using zero CPU cycles until it's time to wake up.</li>
                </ul>
            </p>

            <h3>3. Error Propagation</h3>
            <p>Z8 follows a <strong>Fail-Fast</strong> philosophy. If an uncaught exception occurs inside a timer callback, Z8 will print the full stack trace and exit with status <code>1</code>. This prevents your application from running in an inconsistent, "zombie" state.</p>

            <h2>ðŸ“Š Benchmarks (100 Round-Trip Timers)</h2>
            <div style="overflow-x: auto;">
                <table style="width: 100%; border-collapse: collapse; margin: 1.5rem 0; background: var(--glass-bg); border-radius: 12px; border: 1px solid var(--glass-border);">
                    <thead>
                        <tr style="border-bottom: 2px solid var(--glass-border);">
                            <th style="padding: 1rem; text-align: left;">Runtime</th>
                            <th style="padding: 1rem; text-align: left;">Avg. Time</th>
                            <th style="padding: 1rem; text-align: left;">Performance</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr style="border-bottom: 1px solid var(--glass-border);">
                            <td style="padding: 1rem; color: var(--accent-blue); font-weight: bold;">Zane V8 (Z8)</td>
                            <td style="padding: 1rem; color: var(--accent-blue);">~22 ms</td>
                            <td style="padding: 1rem; color: var(--accent-blue);">100% (Baseline)</td>
                        </tr>
                        <tr style="border-bottom: 1px solid var(--glass-border);">
                            <td style="padding: 1rem;">Deno</td>
                            <td style="padding: 1rem;">~394 ms</td>
                            <td style="padding: 1rem;">~18x Slower</td>
                        </tr>
                        <tr style="border-bottom: 1px solid var(--glass-border);">
                            <td style="padding: 1rem;">Node.js</td>
                            <td style="padding: 1rem;">~1,249 ms</td>
                            <td style="padding: 1rem;">~56x Slower</td>
                        </tr>
                        <tr>
                            <td style="padding: 1rem;">Bun</td>
                            <td style="padding: 1rem;">~1,665 ms</td>
                            <td style="padding: 1rem;">~75x Slower</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <p><small>* Benchmarked on Windows using <code>hyperfine</code> with 100 recursive <code>setTimeout(..., 0)</code> calls.</small></p>

        </main>
    </div>

    <footer>
        <p>&copy; 2026 Zane V8 Project.</p>
    </footer>
</body>
</html>
